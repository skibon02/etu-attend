# etu-schedule
<img src="tsclient/fish.png" width="200"/>

## Что это?
  [***etu-schedule.ru***](https://etu-schedule.ru) - это проект для студентов ЛЭТИ, созданный преимущественно в обучающих целях.
  
### Возможности
- [*Безопасное*](#воруем-ли-мы-ваши-данные) управление посещаемостью в ЛЭТИ. Основным отличием от оригинальной ИС Посещаемость является возможность автоматически отмечаться на парах. Мы используем [токен](#токен-посещаемости) ИС Посещаемость, чтобы наш сервер автоматически отмечал вас на ***выбранных*** парах.
- Просмотр расписания ЛЭТИ. Для любой группы, однако группу поменять нельзя когда установлен токен ИС Посещаемости. В будущих версиях появится возможность отслеживания изменений в расписании прямо в основном интерфейсе, для чего уже подготовлена серверная часть.
- Создание как личных [*заметок*](#заметки) (видных только вам), так и заметок группы. Заметки привязанны к предметам и остаются на той неделе на которой были созданы.
  
Ещё одной возможностью etu-schedule является возможность выбирать, какие именно пары вы хотите посещать. Вы можете настроить режим посещения во вкладке **планирование**.  
  
Также, вы можете временно "отклониться" от своего режима - для этого во вкладке **расписание** рядом с каждым предметом есть кнопка "часики" - нажав на нее, вы можете изменить выбранный план только на эту неделю. 

### Предложения и улучшения
Разделы `Issues`, `Pull requests`, `Discussions` открыты для всех желающих помочь проекту и предложить свои улучшения!

## Токен посещаемости
Для процедуры отметки посещаемости на сервере необходим установленный в профиле токен ИС Посещаемость
Использование токена вместо ввода логина и пароля от личного кабинета ЛЭТИ является более безопасной альтернативой, так как токен позволяет только выполнять запросы в ИС Посещаемость.

### Как получить токен?
На самом сайте присутствует инструкция получения токена, дополненная скриншотами с сайта ИС Посещаемость. Далее представлено более подробное описание. 

+ Чтобы получить токен вам необходимо открыть сам сайт ИС Посещаемость и авторизоваться, если вы не были авторизованы.  
+ После этого нажмите клавишу f12 (или правой кнопкой мыши в любом месте страницы и в появившемся меню выберите `inspect`) - так в любом браузере вы войдёте в меню разработчика.  
+ Найдите вкладку `Network` в верхних строчках открывшегося меню.
+ Внутри нее в строке ниже выберите вкладку `Fetch/XHR` и обновите страницу. В процессе загрузки вы увидете внутренние запросы сайта на сервер.
+ Вам необходимо нажать на запрос, который называется `chek-in` - откроется информация об этом запросе. Нужна та, что находится на вкладе `Headers`.
+ Внутри заголовков запроса найдите параметр Cookie: в самом конце строки находится `"connect.digital-attendance=<ваш_токен>"`.

Сам токен представляет из себя символьную последовательность, например, `s%3A5HvEakctEXAlGuHcK2VmdmGrUJ1uaEij.Q1pxpeJgR31h948gVzNf0tsmBhwXkeH33jP4uzIPotI`. Таким образом, из строки `connect.digital-attendance=s%3A5HvEakctEXAlGuHcK2VmdmGrUJ1uaEij.Q1pxpeJgR31h948gVzNf0tsmBhwXkeH33jP4uzIPotI` вы выбираете сам токен и переносите на наш сайт во вкладку **профиль**.

Спустя время токен может перестать действовать. Тогда он автоматически удалится из профиля при следующей попытке отметки вас на паре, и необходимо будет установить его снова.

## Заметки
Наш сайт также предоставляет возможность оставлять заметки для каждой пары. Существуют заметки двух типов: ваши личные заметки и заметки группы, то есть те, оставлять которые может только староста. 

- ***Как сайт поймет, что пользователь является старостой?*** По токену, поэтому старостам, чтобы оставлять заметки группы, необходимо сначала ввести свой токен.

## Воруем ли мы ваши данные?
Нет, мы не получаем никакой информации о вас на основе вашего токена, за исключением того, в какой группе вы состоите и являетесь ли вы старостой, или публичных данных ВК, таких как ваше имя, фамилия и фотография профиля, необходимые для авторизации. Пользуясь etu-schedule, вы не предоставляете нам никакой приватной информации.

### Техническая информация
Токен ИС Посещаемость используется для:
- Получения информации о том, является ли пользователь старостой
- Получения расписания пользователя для связи с основным расписанием, которое получено из ИС Расписания
- Отправка запроса на отметку посещаемости для пользователя

Запрашивается базовый токен ВКонтакте без дополнительных `scope`'ов и используется для получения:
- имени
- фамилии
- фотографии профиля
- id профиля
- пола
- даты рождения

## Запросы к серверам ЛЭТИ
Все запросы, которые отправляются к серверам ЛЭТИ спроектированы для минимальной нагрузки. Пользуясь сайтом **etu-schedule** нет никакой возможности напрямую влиять на частоту отправляемых запросов к ИС Посещаемость и ИС Расписание. Запросы на расписание кэшируются и происходят независимо от посещения страницы **etu-schedule**.
